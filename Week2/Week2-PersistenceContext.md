# [백엔드 스터디 in 큐시즘 - D조] Week 2: 스프링의 전반적인 이해
## #2. 영속성 컨텍스트와 그 특징은 무엇이 있는가

### 영속성 컨텍스트란?

- 엔티티를 영구 저장하는 환경이란 뜻, 영속화된 엔티티들이 모여있는 곳
- 애플리케이션과 데이터베이스 사이에서 객체(엔티티)를 보관하는 가상의 데이터베이스 같은 역할을 한다.
- 엔티티 매니저를 통해 엔티티를 영속성 컨텍스트에 보관하고 관리할 수 있다.
- ex) em.persist(member)는 member라는 엔티티를 영속성 컨텍스트에 저장한다.

### 영속성 컨텍스트의 특징

#### 식별자 값
- 영속성 컨텍스트는 엔티티를 식별자로 구분하므로 식별자 값이 반드시 있어야한다.

#### 데이터베이스 저장
- flush 함수를 사용해 영속성 컨텍스트에 있던 엔티티들을 데이터베이스에 즉시 반영할 수 있다.

#### 1차 캐시
- 영속성 컨텍스트 안의 1차 캐시에 엔티티들이 저장되는 것이다. 
- 엔티티를 조회할 때 첫번째로 1차 캐시를 조회한다. 있으면 1차 캐시에서 반환되고, 없다면 데이터베이스에서 1차 캐시에 저장한 후 반환된다.
- 영속성 컨텍스트에서 조회한 엔티티는 동일성이 보장된다.

#### 쓰기 지연
- 엔티티 매니저는 트랜잭션이 커밋될 때 모아둔 쿼리들을 데이터베이스에 반영한다.

#### 변경 감지
- 영속성 컨텍스트에 저장된 엔티티 중 데이터베이스와 비교해 변경된 엔티티를 찾고 수정쿼리를 생성해 쓰기 지연 SQL 저장소에 저장한다.
- 그 후 쓰기 지연 저장소의 SQL을 flush한다.
- 정리하자면, 영속성 컨텍스트에 저장된 엔티티를 변경하면 따로 update작업을 해주지 않아도 트랜잭션이 종료될 때 자동으로 수정된다.
